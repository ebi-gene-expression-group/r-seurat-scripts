cli_call: 'seurat-plot.R'
galaxy_tool:
  id: seurat_plot
  name: Plot
  description: with Seurat
  profile: 18.01
  version: "@SEURAT_VERSION@"
  macros:
    - seurat_macros.xml
  macro_expands_header:
    - requirements
    - version
  macro_expands_footer:
    - citations
commands:
  - call: 'load_seurat4_packages_for_format'
    dependencies:
      - workflowscriptscommon
      - optparse
    options:
      - long: formats
        type: internal
        value: 'c(opt$query_format, opt$anchors_format, opt$reference_format)'
  - call: 'read_seurat4_object'
    dependencies:
      - scater
      - SeuratDisk
    options:
      - long: input-object-file
        short: i
        type: file_in
        call_alias: input_path
        human_readable: 'Input file'
        help: "Query file with Seurat object in either RDS-Seurat, Loom or SCE"
      - long: input-format
        type: string
        call_alias: format
        human_readable: 'Input format'
        default: 'seurat'
        help: 'Either loom, seurat, anndata or singlecellexperiment for the input format to read.'
    output:
      - var_name: seurat_object
  - call_carousel: Plot
    long: plot-type
    default: FeaturePlot
    selector:
    - call: RidgePlot
      dependencies:
        - Seurat
        - ggplot2
        - patchwork
      options:
      - long: object
        type: internal
        var_name: seurab_object
      - long: features
        default: ''
        type: string
        help: Features to plot (gene expression, metrics, PC scores, anything that can be
          retreived by FetchData)
      - long: cols
        default: 'NULL'
        optional: true
        help: Colors to use for plotting
      - long: idents
        default: 'NULL'
        optional: true
        help: Which classes to include in the plot (default is all)
      - long: sort
        default: no
        type: boolean
        help: Sort identity classes (on the x-axis) by the average expression of the attribute
          being potted, can also pass 'increasing' or 'decreasing' to change sort direction
      - long: assay
        default: 'NULL'
        optional: true
        help: Name of assay to use, defaults to the active assay
      - long: group.by
        default: 'NULL'
        optional: true
        help: Group (color) cells in different ways (for example, orig.ident)
      - long: y.max
        default: 'NULL'
        optional: true
        help: Maximum y axis value
      - long: same.y.lims
        default: no
        type: boolean
        help: Set all the y-axis limits to the same values
      - long: log
        default: no
        type: boolean
        help: plot the feature axis on log scale
      - long: ncol
        default: 'NULL'
        optional: true
        help: Number of columns if multiple plots are displayed
      - long: slot
        default: data
        optional: true
        type: string
        help: Use non-normalized counts data for plotting
      - long: stack
        default: no
        type: boolean
        help: Horizontally stack plots for each feature
      - long: combine
        default: yes
        type: boolean
        help: Combine plots into a single  list(list("patchwork"), "ed")  ggplot object.
          If  list("FALSE") , return a list of ggplot
      - long: fill.by
        default: feature
        type: string
        optional: true
        help: Color violins/ridges based on either 'feature' or 'ident'
      output:
        - var_name: plot_object
    - call: FeaturePlot
      dependencies:
        - Seurat
        - ggplot2
        - patchwork
      options:
      - long: object
        type: internal
        var_name: seurab_object
      - long: features
        type: list
        help: Vector of features to plot. Features can come from: an assay feature (e.g. a gene name - MS4A1), a
          column name from meta.data (e.g. mitochondrial percentage - percent.mito),
          a column name from a DimReduc object corresponding
          to the cell embedding values (e.g. the PC 1 scores - PC_1).
      - long: dims
        default: "1,2"
        type: list
        help: Dimensions to plot, must be a two-length numeric vector specifying x- and
          y-dimensions
      - long: cells
        default: 'NULL'
        help: Vector of cells to plot (default is all cells)
      - long: cols
        default: if
        optional: true
        type: list
        help: The two colors to form the gradient over. Provide as string vector with the
          first color corresponding to low values, the second to high. Also accepts a Brewer
          color scale or vector of colors.
      - long: pt.size
        default: 'NULL'
        optional: true
        type: integer
        help: Adjust point size for plotting
      - long: order
        default: no
        optional: true
        type: boolean
        help: Boolean determining whether to plot cells in order of expression. Can be useful
          if cells expressing given feature are getting buried.
      - long: min.cutoff
        default: NA
        optional: true
        type: list
        help: Vector of minimum cutoff values for
          each feature, may specify quantile in the form of 'q##' where
          '##' is the quantile (eg, 'q1', 'q10')
      - long: max.cutoff
        default: NA
        optional: true
        type: list
        help: Vector of maximum cutoff values for
          each feature, may specify quantile in the form of 'q##' where
          '##' is the quantile (eg, 'q1', 'q10')
      - long: reduction
        default: 'NULL'
        optional: true
        type: string
        help: Which dimensionality reduction to use. If not specified, first searches for
          umap, then tsne, then pca
      - long: split.by
        default: 'NULL'
        optional: true
        help: A factor in object metadata to split the feature plot by, pass ident to
          split by cell identity; similar to the old FeatureHeatmap.
      - long: keep.scale
        default: feature
        type: string
        options:
          - feature: By row/feature scaling: The plots
              for each individual feature are scaled to the maximum
              expression of the feature across the conditions provided
              to 'split.by'.
          - all: Universal scaling: The plots for all features and
              conditions are scaled to the maximum expression value for
              the feature with the highest overall expression.
          - NULL: No scaling: Each individual plot is scaled to the
              maximum expression value of the feature in the condition
              provided to 'split.by'. Be aware setting NULL will result
              in color scales that are not comparable between plots.
        help: How to handle the color scale across multiple plots.
      - long: shape.by
        default: 'NULL'
        optional: true
        help: If NULL, all points are circles (default). You can specify any cell attribute
          (that can be pulled with FetchData) allowing for both different colors and different
          shapes on cells.  Only applicable if  list("raster = FALSE") .
      - long: slot
        default: data
        optional: true
        type: string
        help: Which slot to pull expression data from?
      - long: blend
        default: no
        type: boolean
        optional: true
        help: Scale and blend expression values to visualize coexpression of two features
      - long: blend.threshold
        default: 0
        type: integer
        optional: true
        help: The color cutoff from weak signal to strong signal; ranges from 0 to 1.
      - long: label
        default: no
        type: boolean
        optional: true
        help: Whether to label the clusters
      - long: label.size
        default: 4
        type: integer
        optional: true
        help: Sets size of labels
      - long: repel
        default: no
        type: boolean
        optional: true
        help: Repel labels
      - long: ncol
        default: 'NULL'
        optional: true
        help: Number of columns to combine multiple feature plots to, ignored if split.by is
          not NULL
      - long: coord.fixed
        default: no
        optional: true
        type: boolean
        help: Plot cartesian coordinates with fixed aspect ratio
      - long: by.col
        default: yes
        type: boolean
        optional: true
        help: If splitting by a factor, plot the splits per column with the features as
          rows; ignored if blend = TRUE.
      - long: sort.cell
        default: 'NULL'
        optional: true
        help: Redundant with 'order'. This argument is being deprecated. Please
          use 'order' instead.
      - long: raster
        default: 'NULL'
        help: Convert points to raster format, default is 'NULL'  which automatically
          rasterizes if plotting more than 100,000 cells
      output:
        - var_name: plot_object
    - call: VlnPlot
      dependencies:
        - Seurat
        - ggplot2
        - patchwork
      options:
      - long: object
        type: internal
        var_name: seurab_object
      - long: features
        default: ''
        type: string
        help: Features to plot (gene expression, metrics, PC scores, anything that can be
          retreived by FetchData)
      - long: cols
        default: 'NULL'
        help: Colors to use for plotting
        type: list
        optional: true
      - long: pt.size
        default: 'NULL'
        type: integer
        optional: true
        help: Point size for geom_violin
      - long: idents
        default: 'NULL'
        type: string
        optional: true
        help: Which classes to include in the plot (default is all)
      - long: sort
        default: no
        type: boolean
        help: Sort identity classes (on the x-axis) by the average expression of the attribute
          being potted, can also pass 'increasing' or 'decreasing' to change sort direction
      - long: assay
        default: 'NULL'
        optional: true
        type: string
        help: Name of assay to use, defaults to the active assay
      - long: group.by
        default: 'NULL'
        optional: true
        type: string
        help: Group (color) cells in different ways (for example, orig.ident)
      - long: split.by
        default: 'NULL'
        optional: true
        type: string
        help: A variable to split the violin plots by,
      - long: adjust
        default: 1
        type: integer
        optional: true
        help: Adjust parameter for geom_violin
      - long: y.max
        default: 'NULL'
        optional: true
        type: float
        help: Maximum y axis value
      - long: same.y.lims
        default: no
        type: boolean
        help: Set all the y-axis limits to the same values
      - long: log
        default: no
        type: boolean
        help: plot the feature axis on log scale
      - long: ncol
        default: 'NULL'
        optional: true
        type: integer
        help: Number of columns if multiple plots are displayed
      - long: slot
        default: data
        type: string
        optional: true
        help: Use non-normalized counts data for plotting
      - long: split.plot
        default: no
        type: boolean
        help: plot each group of the split violin plots by multiple or single violin shapes.
      - long: stack
        default: no
        type: boolean
        help: Horizontally stack plots for each feature
      - long: fill.by
        default: feature
        type: string
        optional: true
        help: Color violins/ridges based on either 'feature' or 'ident'
      - long: flip
        default: no
        type: boolean
        help: flip plot orientation (identities on x-axis)
      output:
        - var_name: plot_object
    - call: DotPlot
      dependencies:
        - Seurat
        - ggplot2
        - patchwork
      options:
      - long: object
        type: internal
        var_name: seurab_object
      - long: assay
        default: 'NULL'
        optional: true
        type: string
        help: Name of assay to use, defaults to the active assay
      - long: features
        default: ''
        type: list
        optional: true
        help: Input vector of features, or named list of feature vectors if feature-grouped
          panels are desired (replicates the functionality of the old SplitDotPlotGG)
      - long: cols
        default: "lightgrey,blue"
        type: list
        optional: true
        help: 'Colors to plot: the name of a palette from RColorBrewer::brewer.pal.info
          , a pair of colors defining a gradient, or 3+ colors defining multiple gradients
          (if split.by is set)'
      - long: col.min
        default: -2
        type: integer
        optional: true
        help: Minimum scaled average expression threshold (everything smaller will be set
          to this)
      - long: col.max
        default: 2
        type: integer
        optional: true
        help: Maximum scaled average expression threshold (everything larger will be set
          to this)
      - long: dot.min
        default: 0
        type: integer
        optional: true
        help: The fraction of cells at which to draw the smallest dot (default is 0). All
          cell groups with less than this expressing the given gene will have no dot drawn.
      - long: dot.scale
        default: 6
        type: integer
        optional: true
        help: Scale the size of the points, similar to cex
      - long: idents
        default: 'NULL'
        type: list
        optional: true
        help: Identity classes to include in plot (default is all)
      - long: group.by
        default: 'NULL'
        optional: true
        type: string
        help: Factor to group the cells by
      - long: split.by
        default: 'NULL'
        optional: true
        type: string
        help: Factor to split the groups by (replicates the functionality of the old SplitDotPlotGG);
          see  list(list("FetchData"))  for more details
      - long: cluster.idents
        default: no
        type: boolean
        help: Whether to order identities by hierarchical clusters based on given features,
          default is FALSE
      - long: scale
        default: yes
        type: boolean
        help: Determine whether the data is scaled, TRUE for default
      - long: scale.by
        default: radius
        optional: true
        type: string
        options:
          - size: Size
          - radius: Radius
        help: Scale the size of the points by 'size' or by 'radius'
      - long: scale.min
        default: NA
        optional: true
        type: float
        help: Set lower limit for scaling, use NA for default
      - long: scale.max
        default: NA
        optional: true
        type: float
        help: Set upper limit for scaling, use NA for default
      output:
        - var_name: plot_object
  - call: if_for_RDS
    rcode: if (!is.null(opt$output_rds_file)) {
  - call: saveRDS
    options:
      - long: output-rds-file
        call_alias: file
        type: file_out
        help: Path to RDS to keep the plot object
        optional: true
        default: 'NULL'
      - long: object
        type: internal
        var_name: plot_object
  - call: close_if_for_RDS
    rcode: }
  - call: ggsave
    dependencies:
      - ggplot2
    options:
    - long: plot-out
      call_alias: filename
      type: file_out
      help: File name to create on disk.
    - long: plot
      type: internal
      var_name: plot_object
    - long: plot_format
      call_alias: device
      default: png
      options:
        - png: PNG
        - eps: EPS
        - ps: PostScript
        - tex: TeX (pictex)
        - pdf: PDF
        - jpeg: JPEG
        - tiff: TIFF
        - svg: SVG
      help: Format to use
    - long: scale
      default: 1
      type: integer
      optional: true
      help: Multiplicative scaling factor.
    - long: width
      type: float
      default: 10
    - long: height
      default: 10
    - long: units
      default: cm
      options:
        - cm: Centimeters
        - in: Inches
        - mm: Milimeters
        - px: Pixels
      type: string
      help: Units for the plot dimensions.
    - long: dpi
      default: 300
      type: string
      help: Plot resolution. Also accepts a string input: retina (320), print (300),
        or screen (72). Applies only to raster output types.
    - long: limitsize
      default: yes
      type: boolean
      help: When TRUE (the default) ggsave() will not save images
        larger than 50x50 inches, to prevent the common error of specifying dimensions
        in pixels.
    - long: bg
      default: 'NULL'
      help: Background colour. If NULL, uses the plot.background fill
        value from the plot theme.
